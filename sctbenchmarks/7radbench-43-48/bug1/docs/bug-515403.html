<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">

  
    <title>Bug 515403 – The bug order (js_FinishRuntimeScriptState 
--&gt; js_{Mark,Sweep}ScriptFilenames) can still occur and cause crash 
with the fix in bug 133773 and 477021</title>


<link rel="Top" href="https://bugzilla.mozilla.org/">

  


  
    <link rel="Show" title="Dependency Tree" href="https://bugzilla.mozilla.org/showdependencytree.cgi?id=515403&amp;hide_resolved=1">
      <link rel="Show" title="Dependency Graph" href="https://bugzilla.mozilla.org/showdependencygraph.cgi?id=515403">

      <link rel="Show" title="Votes (0)" href="https://bugzilla.mozilla.org/votes.cgi?action=show_bug&amp;bug_id=515403">

      <link rel="Show" title="Bug Activity" href="https://bugzilla.mozilla.org/show_activity.cgi?id=515403">
      <link rel="Show" title="Printer-Friendly Version" href="https://bugzilla.mozilla.org/show_bug.cgi?format=multiple&amp;id=515403">


  
    <link rel="Saved&nbsp;Searches" title="My Bugs" href="https://bugzilla.mozilla.org/buglist.cgi?bug_status=UNCONFIRMED&amp;bug_status=NEW&amp;bug_status=ASSIGNED&amp;bug_status=REOPENED&amp;emailassigned_to1=1&amp;emailreporter1=1&amp;emailtype1=exact&amp;email1=naj5c%40virginia.edu&amp;field0-0-0=bug_status&amp;type0-0-0=notequals&amp;value0-0-0=UNCONFIRMED&amp;field0-0-1=reporter&amp;type0-0-1=equals&amp;value0-0-1=naj5c%40virginia.edu">


    


        <link rel="stylesheet" type="text/css" href="bug-515403_files/autocomplete.css">
        <link rel="stylesheet" type="text/css" href="bug-515403_files/calendar.css">

    
      <link href="bug-515403_files/global_003.css" rel="stylesheet" type="text/css">
      <link href="bug-515403_files/show_bug.css" rel="stylesheet" type="text/css">
    <!--[if lte IE 7]>
      
      <link href="skins/standard/IE-fixes.css"
            rel="stylesheet"
            type="text/css">
    <![endif]-->

    
        <link href="bug-515403_files/global_003.css" rel="stylesheet" title="Classic" type="text/css">
        <link href="bug-515403_files/show_bug.css" rel="stylesheet" title="Classic" type="text/css">
      <!--[if lte IE 7]>
      
        <link href="skins/standard/IE-fixes.css"
              rel="stylesheet"
              title="Classic"
              type="text/css">
      <![endif]-->

    
        
            <link href="bug-515403_files/global_004.css" rel="alternate stylesheet" title="BMO" type="text/css">
            <link href="bug-515403_files/show_bug_004.css" rel="alternate stylesheet" title="BMO" type="text/css">
        <!--[if lte IE 7]>
          
          <link href="skins/contrib/BMO/IE-fixes.css"
                rel="alternate stylesheet"
                title="BMO"
                type="text/css">
        <![endif]-->
        
            <link href="bug-515403_files/global.css" rel="alternate stylesheet" title="Dusk" type="text/css">
            <link href="bug-515403_files/show_bug_003.css" rel="alternate stylesheet" title="Dusk" type="text/css">
        <!--[if lte IE 7]>
          
          <link href="skins/contrib/Dusk/IE-fixes.css"
                rel="alternate stylesheet"
                title="Dusk"
                type="text/css">
        <![endif]-->

    

    
        <link href="bug-515403_files/global_002.css" rel="stylesheet" type="text/css">
        <link href="bug-515403_files/show_bug_002.css" rel="stylesheet" type="text/css">
    <!--[if lte IE 7]>
      
      <link href="skins/custom/IE-fixes.css"
            rel="stylesheet"
            type="text/css">
    <![endif]-->

    
    <script src="bug-515403_files/yahoo-dom-event.js" type="text/javascript"></script>
    <script src="bug-515403_files/cookie-min.js" type="text/javascript"></script>
    
      <script type="text/javascript" src="bug-515403_files/json-min.js"></script>
      <script type="text/javascript" src="bug-515403_files/connection-min.js"></script>
      <script type="text/javascript" src="bug-515403_files/datasource-min.js"></script>
      <script type="text/javascript" src="bug-515403_files/autocomplete-min.js"></script>
      <script type="text/javascript" src="bug-515403_files/calendar-min.js"></script>

    <script src="bug-515403_files/global.js" type="text/javascript"></script>

    <script type="text/javascript">
    <!--
        YAHOO.namespace('bugzilla');
        if (YAHOO.env.ua.gecko) {
            YAHOO.util.Event._simpleRemove(window, "unload", 
                                           YAHOO.util.Event._unload);
        }
        
        function unhide_language_selector() { 
            YAHOO.util.Dom.removeClass(
                'lang_links_container', 'bz_default_hidden'
            ); 
        } 
        YAHOO.util.Event.onDOMReady(unhide_language_selector);

        
        var BUGZILLA = {
            param: {
                cookiepath: '\/',
                maxusermatches: 100
            },

            string: {
                attach_desc_required:
                    'You must enter a Description for this attachment.'
            }
        };
    // -->
    </script>

        <script src="bug-515403_files/util.js" type="text/javascript"></script>
        <script src="bug-515403_files/field.js" type="text/javascript"></script>

    


    
    <link rel="search" type="application/opensearchdescription+xml" title="Bugzilla@Mozilla" href="https://bugzilla.mozilla.org/search_plugin.cgi">
    <link rel="shortcut icon" href="https://bugzilla.mozilla.org/skins/custom/images/bugzilla.png">
  </head><body onload="" class="bugzilla-mozilla-org bz_bug bz_status_RESOLVED bz_product_Core bz_component_JavaScript_Engine bz_bug_515403 yui-skin-sam">



<div id="header">
<div id="banner">
  </div>

<table id="titles" border="0" cellpadding="0" cellspacing="0">
<tbody><tr>
    <td id="title">
      <p>Bugzilla@Mozilla – Bug&nbsp;515403</p>
    </td>

    <td id="subtitle">
      <p class="subheader">The bug order (js_FinishRuntimeScriptState 
--&gt; js_{Mark,Sweep}ScriptFilenames) can still occur and cause crash 
with the fix in bug 133773 and 477021</p>
    </td>

    <td id="information">
      <p class="header_addl_info">Last modified: 2009-12-01 10:36:57 PST</p>
    </td>
</tr>
</tbody></table>

<table id="lang_links_container" cellpadding="0" cellspacing="0"><tbody><tr><td>
</td></tr></tbody></table>
<ul class="links">
  <li><a href="https://bugzilla.mozilla.org/">Home</a></li>
  <li><span class="separator">| </span><a href="https://bugzilla.mozilla.org/enter_bug.cgi">New</a></li>
  <li><span class="separator">| </span><a href="https://bugzilla.mozilla.org/describecomponents.cgi">Browse</a></li>
  <li><span class="separator">| </span><a href="https://bugzilla.mozilla.org/query.cgi">Search</a></li>

  <li class="form">
    <span class="separator">| </span>
    <form action="buglist.cgi" method="get" onsubmit="if (this.quicksearch.value == '')
                  { alert('Please enter one or more search terms first.');
                    return false; } return true;">
    <input class="txt" id="quicksearch_top" name="quicksearch" type="text">
    <input class="btn" value="Search" id="find_top" type="submit"></form>
  <a href="https://bugzilla.mozilla.org/page.cgi?id=quicksearch.html" title="Quicksearch Help">[?]</a></li>

  <li><span class="separator">| </span><a href="https://bugzilla.mozilla.org/report.cgi">Reports</a></li>

  <li>
      <span class="separator">| </span>
        <a href="https://bugzilla.mozilla.org/request.cgi?requester=naj5c%40virginia.edu&amp;requestee=naj5c%40virginia.edu&amp;do_union=1&amp;group=type&amp;action=queue">My Requests</a></li>

    <li><span class="separator">| </span><a href="https://bugzilla.mozilla.org/userprefs.cgi">Preferences</a></li>
<li>
        <span class="separator">| </span>
        <a href="http://www.bugzilla.org/docs/3.6/en/html/bug_page.html" target="_blank">Help</a>
      </li>

    <li>
      <span class="separator">| </span>
        <a href="https://bugzilla.mozilla.org/index.cgi?logout=1">Log&nbsp;out</a>
        naj5c@virginia.edu</li>
</ul>
</div> 

<div id="bugzilla-body">
<!-- <div style="border: 2px dotted red;">
<p style="padding: 5px; margin: 0px; color: red; text-align: center;">Bugzilla will be offline for up to 30 minutes starting at 6pm PDT (0100 UTC) for a kernel update and RAM upgrade on its master database server.</p>
</div>
<br> -->

<div class="navigation">
  
  <i><font color="#777777">First</font></i>
  <i><font color="#777777">Last</font></i>
  <i><font color="#777777">Prev</font></i>
  <i><font color="#777777">Next</font></i>
  &nbsp;&nbsp;
  <i><font color="#777777">No search results available</font></i>
</div>
<script type="text/javascript">
  <!--
  
  /* Outputs a link to call replyToComment(); used to reduce HTML output */
  function addReplyLink(id, real_id) {
      /* XXX this should really be updated to use the DOM Core's
       * createElement, but finding a container isn't trivial.
       */
        document.write('[<a href="#add_comment" onclick="replyToComment(' + 
                       id + ',' + real_id + '); return false;">reply<' + '/a>]');
  }

  /* Adds the reply text to the `comment' textarea */
  function replyToComment(id, real_id) {
      var prefix = "(In reply to comment #" + id + ")\n";
      var replytext = "";
        /* pre id="comment_name_N" */
        var text_elem = document.getElementById('comment_text_'+id);
        var text = getText(text_elem);

        /* make sure we split on all newlines -- IE or Moz use \r and \n
         * respectively.
         */
        text = text.split(/\r|\n/);

        for (var i=0; i < text.length; i++) {
            replytext += "> " + text[i] + "\n"; 
        }

        replytext = prefix + replytext + "\n";


      /* <textarea id="comment"> */
      var textarea = document.getElementById('comment');
      textarea.value += replytext;

      textarea.focus();
  }

  if (typeof Node == 'undefined') {
      /* MSIE doesn't define Node, so provide a compatibility object */
      window.Node = {
          TEXT_NODE: 3,
          ENTITY_REFERENCE_NODE: 5
      };
  }

  /* Concatenates all text from element's childNodes. This is used
   * instead of innerHTML because we want the actual text (and
   * innerText is non-standard).
   */
  function getText(element) {
      var child, text = "";
      for (var i=0; i < element.childNodes.length; i++) {
          child = element.childNodes[i];
          var type = child.nodeType;
          if (type == Node.TEXT_NODE || type == Node.ENTITY_REFERENCE_NODE) {
              text += child.nodeValue;
          } else {
              /* recurse into nodes of other types */
              text += getText(child);
          }
      }
      return text;
  }


  //-->
  </script>

<form name="changeform" method="post" action="process_bug.cgi">

  <input name="delta_ts" value="2009-12-01 10:36:57" type="hidden">
  <input name="longdesclength" value="18" type="hidden">
  <input name="id" value="515403" type="hidden">
  <input name="token" value="1283362497-6fd7eb44e426205b215acf8a8459e042" type="hidden">
<div class="bz_alias_short_desc_container edit_form">
    <span class="last_comment_link">
      <a href="#c17" accesskey="l"><b>L</b>ast Comment</a>
    </span>
     <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=515403"><b>Bug&nbsp;515403</b></a> -<span id="summary_alias_container"> 
      <span id="short_desc_nonedit_display">The bug order 
(js_FinishRuntimeScriptState --&gt; js_{Mark,Sweep}ScriptFilenames) can 
still occur and cause crash with the fix in <span class="bz_closed"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=133773" title="VERIFIED FIXED - malign race to use and destroy runtime state in js_DestroyContext">bug 133773</a></span> and 477021</span>
     </span>
  
       
    <div class="bz_default_hidden" id="summary_alias_input">
      <table id="summary"> 
          <tbody><tr>
            <td colspan="2">
          </td>
        </tr> 
        
        <tr>
          <td>
            <label accesskey="s" for="short_desc"><u>S</u>ummary</label>:
          </td>
          <td><span title="The bug order (js_FinishRuntimeScriptState --&gt; js_{Mark,Sweep}ScriptFilenames) can still occur and cause crash with the fix in bug 133773 and 477021">The bug order (js_FinishRuntimeScriptState --&gt; js_{Mark,Sweep}ScriptFilenames...
        </span>
          </td>
        </tr>
      </tbody></table>
    </div>
  </div>
  <script type="text/javascript">
    hideAliasAndSummary('The bug order (js_FinishRuntimeScriptState --> js_{Mark,Sweep}ScriptFilenames) can still occur and cause crash with the fix in bug 133773 and 477021', '');
  </script>
  <table class="edit_form">
    <tbody><tr>
      
      <td id="bz_show_bug_column_1" class="bz_show_bug_column">     
        <table class="bz_show_bug_column_table">
          <tbody><tr>
    <td class="field_label">
      <b><a href="https://bugzilla.mozilla.org/page.cgi?id=fields.html#status">Status</a></b>:
    </td>
    <td id="bz_field_status">
      <span id="static_bug_status">RESOLVED
          FIXED
      </span>
    </td>
  </tr>
    <tr>
      <td class="field_label">
        <label for="status_whiteboard" accesskey="w"><b><u>W</u>hiteboard</b></label>:
      </td><td colspan="2">[ccbr] fixed-in-tracemonkey  
  </td>
    </tr>
  
    <tr>
      <td class="field_label">
        <label for="keywords" accesskey="k">
          <b><a href="https://bugzilla.mozilla.org/describekeywords.cgi"><u>K</u>eywords</a></b></label>:
      </td>
      <td class="field_value" colspan="2">
      </td>
    </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          <tr><th class="field_label " id="field_label_product">
        <a href="https://bugzilla.mozilla.org/describecomponents.cgi">Product:</a>
  </th>

<td class="field_value " id="field_container_product">Core</td>
    </tr>
        
    
    
    <tr>
      <td class="field_label">
        <label for="component" accesskey="m">
          <b><a href="https://bugzilla.mozilla.org/describecomponents.cgi?product=Core">
            Co<u>m</u>ponent</a>:
          </b>
        </label>
      </td><td>JavaScript Engine
  </td>
    </tr>
    <tr>
      <td class="field_label">
        <label for="version"><b>Version</b></label>:
      </td>
<td>unspecified
  </td>
    </tr>
        
    
        
    <tr>
      <td class="field_label">
        <label for="rep_platform" accesskey="h"><b>Platform</b></label>:
      </td>
      <td class="field_value">All
       Linux
       <script type="text/javascript">
         assignToDefaultOnChange(['product', 'component']);
       </script>
      </td>
    </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          
          <tr>
      <td class="field_label">
        <label for="priority" accesskey="i">
          <b><a href="https://bugzilla.mozilla.org/page.cgi?id=fields.html#importance"><u>I</u>mportance</a></b></label>:
      </td>
      <td>P2
       critical
          <span id="votes_container">    
          (<a href="https://bugzilla.mozilla.org/votes.cgi?action=show_user&amp;bug_id=515403#vote_515403">vote</a>)
          </span>  
      </td>
    </tr>

      <tr>
        <td class="field_label">
          <label for="target_milestone">
              <a href="https://bugzilla.mozilla.org/page.cgi?id=fields.html#target_milestone">
            Target&nbsp;Milestone</a></label>:
        </td><td>---
  </td>
      </tr>            
          
          <tr>
      <td class="field_label">
        <b><a href="https://bugzilla.mozilla.org/page.cgi?id=fields.html#assigned_to">Assigned To</a></b>:
      </td>
      <td><span class="vcard"><a class="email" href="mailto:igor@mir2.org" title="Igor Bukanov &lt;igor@mir2.org&gt;"> <span class="fn">Igor Bukanov</span></a>
</span>
      </td>
    </tr>

    <tr>
      <td class="field_label">
        <label for="qa_contact" accesskey="q"><b><u>Q</u>A Contact</b></label>:
      </td>
      <td><span class="vcard"><a class="email" href="mailto:general@spidermonkey.bugs" title="general@spidermonkey.bugs">general@spidermonkey.bugs</a>
</span>
      </td>
    </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          <tr>
    <td class="field_label">
      <label for="bug_file_loc" accesskey="u"><b>
          <u>U</u>RL</b></label>:
    </td>
    <td>
      <span id="bz_url_input_area">
          <a href=""></a>
      </span>
    </td>
  </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          
          <tr><th class="field_label">
    <label for="dependson">Depends&nbsp;on</label>:
  </th>
  <td>    
    <span id="dependson_input_area">
    </span>
    
  </td>
  </tr>
  
  <tr><th class="field_label">
    <label for="blocked" accesskey="b"><u>B</u>locks</label>:
  </th>
  <td>    
    <span id="blocked_input_area">
    </span>
    
  </td>
  
  </tr><tr>
    <th>&nbsp;</th>
  
    <td colspan="2" id="show_dependency_tree_or_graph" align="left">
      Show dependency <a href="https://bugzilla.mozilla.org/showdependencytree.cgi?id=515403&amp;hide_resolved=1">tree</a>
  
        /&nbsp;<a href="https://bugzilla.mozilla.org/showdependencygraph.cgi?id=515403">graph</a>
    </td>
  </tr>
          
            <tr>
              <td colspan="2"><div class="knob-buttons">
      <input value="Save Changes" id="commit_top" type="submit">
    </div>
              </td>
            </tr>
        </tbody></table>
      </td>
      <td>
        <div class="bz_column_spacer">&nbsp;</div>
      </td>
      
      <td id="bz_show_bug_column_2" class="bz_show_bug_column">
        <table class="bz_show_bug_column_table" cellpadding="3" cellspacing="1">
        <tbody><tr>
    <td class="field_label">
      <b>Reported</b>:
    </td>
    <td>2009-09-09 09:42 PDT by <span class="vcard"><a class="email" href="mailto:hc2428@columbia.edu" title="Heming Cui &lt;hc2428@columbia.edu&gt;"> <span class="fn">Heming Cui</span></a>
</span>
    </td>
  </tr>
  
  <tr>
    <td class="field_label">
      <b> Modified</b>:
    </td>
    <td>2009-12-01 10:36 PST 
      (<a href="https://bugzilla.mozilla.org/show_activity.cgi?id=515403">History</a>)
    </td>
  
  </tr>
         <tr>
      <td class="field_label">
        <label for="newcc" accesskey="a"><b>CC List</b>:</label>
      </td>
      <td>
            <input id="addselfcc" name="addselfcc" checked="checked" type="checkbox">
            <label for="addselfcc">Add me to CC list</label>
            <br> 10 
          users
        <span id="cc_edit_area_showhide_container">
          (<a href="#" id="cc_edit_area_showhide">edit</a>)
            <div id="cc_list_num_users">
              <ul class="cc_list_display"> 
                  <li>brendan@mozilla.org</li>
                  <li>dvander@alliedmods.net</li>
                  <li>gal@uci.edu</li>
                  <li>igor@mir2.org</li>
                  <li>jorendorff@mozilla.com</li>
                  <li>ladamski@mozilla.com</li>
                  <li>ryanvm@gmail.com</li>
                  <li>sayrer@gmail.com</li>
                  <li>slice4e@gmail.com</li>
                  <li>xtc4uall@gmail.com</li>
              </ul>
            </div>
        </span>
        <div class="bz_default_hidden" id="cc_edit_area">
            <div>
              <div><label for="cc"><b>Add</b></label></div><div class="yui-ac" id="newcc_autocomplete">  
  <input autocomplete="off" class="yui-ac-input" name="newcc" size="30" id="newcc">
    <div class="yui-ac-container" id="newcc_autocomplete_container"><div style="display: none;" class="yui-ac-content"><div style="display: none;" class="yui-ac-hd"></div><div class="yui-ac-bd"><ul><li style="display: none;"></li><li style="display: none;"></li><li style="display: none;"></li><li style="display: none;"></li><li style="display: none;"></li><li style="display: none;"></li><li style="display: none;"></li><li style="display: none;"></li><li style="display: none;"></li><li style="display: none;"></li></ul></div><div style="display: none;" class="yui-ac-ft"></div></div></div>
    </div>  
    <script type="text/javascript">
      if( typeof(YAHOO.bugzilla.userAutocomplete) !== 'undefined' 
          && YAHOO.bugzilla.userAutocomplete != null){
        YAHOO.bugzilla.userAutocomplete.init( "newcc", 
                    "newcc_autocomplete_container", true);        
      }
    </script>
            </div>
            <select id="cc" name="cc" multiple="multiple" size="5">
                <option value="brendan@mozilla.org">brendan@mozilla.org</option>
                <option value="dvander@alliedmods.net">dvander@alliedmods.net</option>
                <option value="gal@uci.edu">gal@uci.edu</option>
                <option value="igor@mir2.org">igor@mir2.org</option>
                <option value="jorendorff@mozilla.com">jorendorff@mozilla.com</option>
                <option value="ladamski@mozilla.com">ladamski@mozilla.com</option>
                <option value="ryanvm@gmail.com">ryanvm@gmail.com</option>
                <option value="sayrer@gmail.com">sayrer@gmail.com</option>
                <option value="slice4e@gmail.com">slice4e@gmail.com</option>
                <option value="xtc4uall@gmail.com">xtc4uall@gmail.com</option>
            </select>
              <br>
              <input id="removecc" name="removecc" type="checkbox"><label for="removecc">Remove selected CCs</label>
              <br>
        </div>
        <script type="text/javascript">
          hideEditableField( 'cc_edit_area_showhide_container', 
                             'cc_edit_area', 
                             'cc_edit_area_showhide', 
                             '', 
                             '');  
        </script>
      </td>
    </tr>
         <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr>
      <td class="field_label flags_label">
        <label><b>Flags:</b></label>
      </td>
      <td></td>
    </tr>
    <tr>
      <td colspan="2"><script type="text/javascript" src="bug-515403_files/flag.js"></script>

<table id="flags">

  
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
      <tbody><tr>
        <td>sayrer:
        </td>
        <td>
          <label title="Use this flag to nominate bugs for fixing for the 1.9.2 release. If the bug
is deemed critical for the release by drivers@mozilla.org it will
receive a &quot;+&quot;. If the bug is deemed to not be critical for this release
drivers will add a &quot;-&quot; to the flag." for="flag-333484">blocking1.9.2</label>
        </td>
        <td>
          <select id="flag-333484" name="flag-333484" title="Use this flag to nominate bugs for fixing for the 1.9.2 release. If the bug
is deemed critical for the release by drivers@mozilla.org it will
receive a &quot;+&quot;. If the bug is deemed to not be critical for this release
drivers will add a &quot;-&quot; to the flag." onchange="toggleRequesteeField(this);" class="flag_select flag_type-479">
            
              <option value="X"></option>
              <option value="+" selected="selected">+</option>
          </select>
        </td>
      </tr>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
<tr>
    <td>&nbsp;</td>
    <td>

      <label title="flag to mark bugs as highly desired for Fennec 1.0, but not blocking final release" for="flag_type-422">wanted‑fennec1.0</label>
    </td>
    <td>
      <select id="flag_type-422" name="flag_type-422" title="flag to mark bugs as highly desired for Fennec 1.0, but not blocking final release" onchange="toggleRequesteeField(this);" class="flag_select flag_type-422">
        <option selected="selected" value="X"></option>
          <option value="?">?</option>
      </select>
    </td>
  </tr>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
      <tr>
        <td>igor:
        </td>
        <td>
          <label title="This is for drivers to track bugs that do not block the next 1.9.0.x release but are important." for="flag-333485">wanted1.9.0.x</label>
        </td>
        <td>
          <select id="flag-333485" name="flag-333485" title="This is for drivers to track bugs that do not block the next 1.9.0.x release but are important." onchange="toggleRequesteeField(this);" class="flag_select flag_type-385">
            
              <option value="?" selected="selected">?</option>
          </select>
        </td>
      </tr>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
<tr>
    <td>&nbsp;</td>
    <td>

      <label title="Whether the bug has a testcase in the test suite or not. Set it to &quot;in-testsuite?&quot; if the bug needs a testcase (only set this if the bug actually &lt;em&gt;needs&lt;/em&gt; a testcase &amp;mdash; not all bugs do, even layout bugs!), set it to &quot;in-testsuite+&quot; if the bug has an appropriate testcase, and set it to &quot;in-testsuite-&quot; if the bug doesn't need an explicit testcase (e.g. for code cleanup bugs). Only QA actively working on test cases in the component should use this keyword." for="flag_type-37">in‑testsuite</label>
    </td>
    <td>
      <select id="flag_type-37" name="flag_type-37" title="Whether the bug has a testcase in the test suite or not. Set it to &quot;in-testsuite?&quot; if the bug needs a testcase (only set this if the bug actually &lt;em&gt;needs&lt;/em&gt; a testcase &amp;mdash; not all bugs do, even layout bugs!), set it to &quot;in-testsuite+&quot; if the bug has an appropriate testcase, and set it to &quot;in-testsuite-&quot; if the bug doesn't need an explicit testcase (e.g. for code cleanup bugs). Only QA actively working on test cases in the component should use this keyword." onchange="toggleRequesteeField(this);" class="flag_select flag_type-37">
        <option selected="selected" value="X"></option>
          <option value="?">?</option>
          <option value="+">+</option>
          <option value="-">-</option>
      </select>
    </td>
  </tr>
    
    
    
    
<tr>
    <td>&nbsp;</td>
    <td>

      <label title="Whether the bug has a testcase in the Litmus test suite or not. Set it to &quot;in-litmus?&quot; if the bug needs a testcase (only set this if the bug actually &lt;em&gt;needs&lt;/em&gt; a testcase &amp;mdash; not all bugs do, even layout bugs!), set it to &quot;in-litmus+&quot; if the bug has an appropriate Litmus testcase, and set it to &quot;in-litmus-&quot; if the bug doesn't need an explicit testcase (e.g. for code cleanup bugs). Only QA actively working on test cases in the component should use this keyword." for="flag_type-325">in‑litmus</label>
    </td>
    <td>
      <select id="flag_type-325" name="flag_type-325" title="Whether the bug has a testcase in the Litmus test suite or not. Set it to &quot;in-litmus?&quot; if the bug needs a testcase (only set this if the bug actually &lt;em&gt;needs&lt;/em&gt; a testcase &amp;mdash; not all bugs do, even layout bugs!), set it to &quot;in-litmus+&quot; if the bug has an appropriate Litmus testcase, and set it to &quot;in-litmus-&quot; if the bug doesn't need an explicit testcase (e.g. for code cleanup bugs). Only QA actively working on test cases in the component should use this keyword." onchange="toggleRequesteeField(this);" class="flag_select flag_type-325">
        <option selected="selected" value="X"></option>
          <option value="?">?</option>
          <option value="+">+</option>
          <option value="-">-</option>
      </select>
    </td>
  </tr>

  
</tbody></table>
      </td>
    </tr>
<tr><th class="field_label " id="field_label_see_also">
        <a href="https://bugzilla.mozilla.org/page.cgi?id=fields.html#see_also">See Also:</a>
  </th>

<td class="field_value " id="field_container_see_also"></td>
    </tr> 
         <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr><th class="field_label " id="field_label_cf_blocking_fennec">blocking-fennec:
  </th>

<td class="field_value " id="field_container_cf_blocking_fennec" colspan="2">---</td>
    </tr>
    <tr><th class="field_label " id="field_label_cf_blocking_20">blocking2.0:
  </th>

<td class="field_value " id="field_container_cf_blocking_20" colspan="2">---</td>
    </tr>
    <tr><th class="field_label " id="field_label_cf_status_20">status2.0:
  </th>

<td class="field_value " id="field_container_cf_status_20" colspan="2">---</td>
    </tr>
    <tr><th class="field_label " id="field_label_cf_blocking_192">blocking1.9.2:
  </th>

<td class="field_value " id="field_container_cf_blocking_192" colspan="2">---</td>
    </tr>
    <tr><th class="field_label " id="field_label_cf_status_192">status1.9.2:
  </th>

<td class="field_value " id="field_container_cf_status_192" colspan="2">beta3-fixed</td>
    </tr>
    <tr><th class="field_label " id="field_label_cf_blocking_191">blocking1.9.1:
  </th>

<td class="field_value " id="field_container_cf_blocking_191" colspan="2">---</td>
    </tr>
    <tr><th class="field_label " id="field_label_cf_status_191">status1.9.1:
  </th>

<td class="field_value " id="field_container_cf_status_191" colspan="2">---</td>
    </tr>
         

        </tbody></table>
      </td>
    </tr>
    <tr>
      <td colspan="3">
          <hr id="bz_top_half_spacer">
      </td>
    </tr>
  </tbody></table>

  <table id="bz_big_form_parts" cellpadding="0" cellspacing="0"><tbody><tr>
  <td>

    
<script type="text/javascript">
<!--
function toggle_display(link) {
    var table = document.getElementById("attachment_table");
    // Store current height for scrolling later
    var originalHeight = table.offsetHeight;
    var rows = YAHOO.util.Dom.getElementsByClassName(
        'bz_tr_obsolete', 'tr', table);

    for (var i = 0; i < rows.length; i++) {
        bz_toggleClass(rows[i], 'bz_default_hidden');
    }

    if (YAHOO.util.Dom.hasClass(rows[0], 'bz_default_hidden')) {
        link.innerHTML = "Show Obsolete";
    }
    else {
        link.innerHTML = "Hide Obsolete";
    }

    var newHeight = table.offsetHeight;
    // This scrolling makes the window appear to not move at all.
    window.scrollBy(0, newHeight - originalHeight);

    return false;
}
//-->
</script>

<br>
<table id="attachment_table" cellpadding="4" cellspacing="0">
  <tbody><tr>
    <th colspan="3" align="left">
      <a name="a0" id="a0">Attachments</a>
    </th>
  </tr>


      <tr class="bz_contenttype_application_octet-stream">
        <td valign="top">
            <a name="a1" href="https://bugzilla.mozilla.org/attachment.cgi?id=399496" title="View the content of the attachment">
          <b>patch for semphores. We just need two semaphores to expose this bug order.</b></a>

          <span class="bz_attach_extra_info">
              (8.35 KB,
                application/octet-stream)

            <br>
            <a href="#attach_399496" title="Go to the comment associated with the attachment">2009-09-09 09:57 PDT</a>,
<span class="vcard"><a class="email" href="mailto:hc2428@columbia.edu" title="Heming Cui &lt;hc2428@columbia.edu&gt;"> <span class="fn">Heming Cui</span></a>
</span>
          </span>
        </td>

          <td class="bz_attach_flags" valign="top">
              <i>no flags</i>
          </td>

        <td valign="top">
          <a href="https://bugzilla.mozilla.org/attachment.cgi?id=399496&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr class="bz_contenttype_application_octet-stream">
        <td valign="top">
            <a name="a2" href="https://bugzilla.mozilla.org/attachment.cgi?id=399499" title="View the content of the attachment">
          <b>my testcase, just two threads.</b></a>

          <span class="bz_attach_extra_info">
              (2.35 KB,
                application/octet-stream)

            <br>
            <a href="#attach_399499" title="Go to the comment associated with the attachment">2009-09-09 10:00 PDT</a>,
<span class="vcard"><a class="email" href="mailto:hc2428@columbia.edu" title="Heming Cui &lt;hc2428@columbia.edu&gt;"> <span class="fn">Heming Cui</span></a>
</span>
          </span>
        </td>

          <td class="bz_attach_flags" valign="top">
              <i>no flags</i>
          </td>

        <td valign="top">
          <a href="https://bugzilla.mozilla.org/attachment.cgi?id=399499&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr class="bz_contenttype_application_pdf">
        <td valign="top">
            <a name="a3" href="https://bugzilla.mozilla.org/attachment.cgi?id=399501" title="View the content of the attachment">
          <b>the pseudo shows how threads and semaphores work in my patch.</b></a>

          <span class="bz_attach_extra_info">
              (31.14 KB,
                application/pdf)

            <br>
            <a href="#attach_399501" title="Go to the comment associated with the attachment">2009-09-09 10:14 PDT</a>,
<span class="vcard"><a class="email" href="mailto:hc2428@columbia.edu" title="Heming Cui &lt;hc2428@columbia.edu&gt;"> <span class="fn">Heming Cui</span></a>
</span>
          </span>
        </td>

          <td class="bz_attach_flags" valign="top">
              <i>no flags</i>
          </td>

        <td valign="top">
          <a href="https://bugzilla.mozilla.org/attachment.cgi?id=399501&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr class="bz_contenttype_text_plain bz_patch bz_tr_obsolete bz_default_hidden">
        <td valign="top">
            <a name="a4" href="https://bugzilla.mozilla.org/attachment.cgi?id=402557" title="View the content of the attachment">
          <b><span class="bz_obsolete">fix v1</span></b></a>

          <span class="bz_attach_extra_info">
              (5.27 KB,
                patch)

            <br>
            <a href="#attach_402557" title="Go to the comment associated with the attachment">2009-09-24 03:01 PDT</a>,
<span class="vcard"><a class="email" href="mailto:igor@mir2.org" title="Igor Bukanov &lt;igor@mir2.org&gt;"> <span class="fn">Igor Bukanov</span></a>
</span>
          </span>
        </td>

          <td class="bz_attach_flags" valign="top">
              <i>no flags</i>
          </td>

        <td valign="top">
          <a href="https://bugzilla.mozilla.org/attachment.cgi?id=402557&amp;action=edit">Details</a>
            | <a href="https://bugzilla.mozilla.org/attachment.cgi?id=402557&amp;action=diff">Diff</a>
        </td>
      </tr>
      <tr class="bz_contenttype_text_plain bz_patch">
        <td valign="top">
            <a name="a5" href="https://bugzilla.mozilla.org/attachment.cgi?id=402564" title="View the content of the attachment">
          <b>fix v2</b></a>

          <span class="bz_attach_extra_info">
              (7.25 KB,
                patch)

            <br>
            <a href="#attach_402564" title="Go to the comment associated with the attachment">2009-09-24 04:52 PDT</a>,
<span class="vcard"><a class="email" href="mailto:igor@mir2.org" title="Igor Bukanov &lt;igor@mir2.org&gt;"> <span class="fn">Igor Bukanov</span></a>
</span>
          </span>
        </td>

          <td class="bz_attach_flags" valign="top">brendan:
                review+
                <br>
          </td>

        <td valign="top">
          <a href="https://bugzilla.mozilla.org/attachment.cgi?id=402564&amp;action=edit">Details</a>
            | <a href="https://bugzilla.mozilla.org/attachment.cgi?id=402564&amp;action=diff">Diff</a>
        </td>
      </tr>

  <tr class="bz_attach_footer">
    <td colspan="3">
        <span class="bz_attach_view_hide">
            <a href="#a0" onclick="return toggle_display(this);">Show
              Obsolete</a> (1)
            <a href="https://bugzilla.mozilla.org/attachment.cgi?bugid=515403&amp;action=viewall">View All</a>
        </span>
      <a href="https://bugzilla.mozilla.org/attachment.cgi?bugid=515403&amp;action=enter">Add an attachment</a>
      (proposed patch, testcase, etc.)
    </td>
  </tr>
</tbody></table>
<br>

  </td>
  <td>
  </td>
  </tr></tbody></table>

  

  
  <div id="comments"><script type="text/javascript">
  <!--
  function updateCommentPrivacy(checkbox, id) {
    var comment_elem = document.getElementById('comment_text_'+id).parentNode;
    if (checkbox.checked) {
      if (!comment_elem.className.match('bz_private')) {
        comment_elem.className = comment_elem.className.concat(' bz_private');
      }
    }
    else {
      comment_elem.className =
        comment_elem.className.replace(/(\s*|^)bz_private(\s*|$)/, '$2');
    }
  }

  /* The functions below expand and collapse comments  */

  function toggle_comment_display(link, comment_id) {
    var comment = document.getElementById('comment_text_' + comment_id);
    var re = new RegExp(/\bcollapsed\b/);
    if (comment.className.match(re))
        expand_comment(link, comment);
    else
        collapse_comment(link, comment);
  }

  function toggle_all_comments(action) {
    var num_comments = 18;

    // If for some given ID the comment doesn't exist, this doesn't mean
    // there are no more comments, but that the comment is private and
    // the user is not allowed to view it.

    for (var id = 0; id < num_comments; id++) {
        var comment = document.getElementById('comment_text_' + id);
        if (!comment)
            continue;

        var link = document.getElementById('comment_link_' + id);
        if (action == 'collapse')
            collapse_comment(link, comment);
        else
            expand_comment(link, comment);
    }
  }

  function collapse_comment(link, comment) {
    link.innerHTML = "[+]";
    link.title = "Expand the comment.";
    YAHOO.util.Dom.addClass(comment, 'collapsed');
  }

  function expand_comment(link, comment) {
    link.innerHTML = "[-]";
    link.title = "Collapse the comment";
    YAHOO.util.Dom.removeClass(comment, 'collapsed');
  }

  /* This way, we are sure that browsers which do not support JS
   * won't display this link  */

  function addCollapseLink(count) {
    document.write(' <a href="#" class="bz_collapse_comment"' +
                   ' id="comment_link_' + count +
                   '" onclick="toggle_comment_display(this, ' +  count +
                   '); return false;" title="Collapse the comment.">[-]<\/a> ');
  }
  //-->
  </script>










<!-- This auto-sizes the comments and positions the collapse/expand links 
     to the right. -->
<table class="bz_comment_table" cellpadding="0" cellspacing="0"><tbody><tr>
<td>
<div class="bz_comment bz_first_comment">

      <div class="bz_first_comment_head">

          <span class="bz_comment_actions">
            <script type="text/javascript"><!--
              addReplyLink(0, 4290013);
              addCollapseLink(0); // -->
            </script>[<a href="#add_comment" onclick="replyToComment(0,4290013); return false;">reply</a>] <a href="#" class="bz_collapse_comment" id="comment_link_0" onclick="toggle_comment_display(this, 0); return false;" title="Collapse the comment.">[-]</a> 
          </span>


        <span class="bz_comment_number">
          <a name="c0" href="https://bugzilla.mozilla.org/show_bug.cgi?id=515403#c0">Description</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><a class="email" href="mailto:hc2428@columbia.edu" title="Heming Cui &lt;hc2428@columbia.edu&gt;"> <span class="fn">Heming Cui</span></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2009-09-09 09:42:47 PDT
        </span>
      </div>



<pre class="bz_comment_text" id="comment_text_0">User-Agent:       Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0; Maxthon;
SLCC1; .NET CLR 2.0.50727; Media Center PC 5.0; .NET CLR 1.1.4322; InfoPath.2;
MS-RTC LM 8; CIBA; .NET CLR 3.5.30729; .NET CLR 3.0.30618)
Build Identifier: The bug order (js_FinishRuntimeScriptState --&gt;
js_SweepScriptFilenames) can still occur and cause crash

Dear developers:
    I am investigating the bug order (js_FinishRuntimeScriptState --&gt;
js_SweepScriptFilenames) in latest javascript code in hg repository. In this
bug order, js_FinishRuntimeScriptState will destroy a hash table, then
js_SweepScriptFilenames will access this table, causing a crash. I have used
sempahores to successfully enforce a feasible schedule in latest source code to
prove that this bug order can still happen.

    Although this bug can be hidden by another fix for another <span class="bz_closed"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=131246" title="VERIFIED FIXED - Crash after out-of-memory in JS_NewContext()">bug 131246</a></span> (the
fix for this bug is adding NULL check at js_{Mark,Sweep}AtomState), this bug
order is very dangerous. In the past 7 years (starting from the <span class="bz_closed"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=133773" title="VERIFIED FIXED - malign race to use and destroy runtime state in js_DestroyContext">bug 133773</a></span> at
2002), developers have tried some ordering mechanisms like js_WaitForGC to
avoid this bug order, but failed.

    The corresponding bug order in old code (js-1.5) is (js_FreeAtomState --&gt;
js_{Mark,Sweep}AtomState). Regarding the fixes in <span class="bz_closed"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=133773" title="VERIFIED FIXED - malign race to use and destroy runtime state in js_DestroyContext">bug 133773</a></span>, my schedule can
cause a crash (please refer to the 133773 and 477021 bug pages for more
details), because the NULL check at js_{Mark,Sweep}AtomState has not been
deployed when <span class="bz_closed"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=133773" title="VERIFIED FIXED - malign race to use and destroy runtime state in js_DestroyContext">bug 133773</a></span> is being fixed. This means that the fix in <span class="bz_closed"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=133773" title="VERIFIED FIXED - malign race to use and destroy runtime state in js_DestroyContext">bug 133773</a></span>
actually can not fix 133773, and a crash can still occur after the patches in
133773 are added.

    Since I am using semaphores, this bug can happen at each execution.

Reproducible: Always

Steps to Reproduce:
1. Add my patch to latest js source code in hg repository.
2. Run my simple testcase (just start two threads and only two threads).
3. Bug occur.
Actual Results:  
Below is my output, which shows js_FinishRuntimeScriptState is called in one
thread, and then js_{Mark,Sweep}ScriptFilenames is called in another thread:

---------------------------------------------------------------------------
DestroyContext tid -1220404336 in critical region, js_ContextNum 2
Tid -1220404336 sets -1220404336 to sem 1 tid1
Tid -1220404336 sets -1220404336 to sem 2 tid2
Tid -1220404336 js_WaitForGC in js_DestroyContext
enter js_GC tid -1220404336, rt state 2, gcLevel 0
Tid -1220404336 post on sem 1
Tid -1220404336 wait on sem 2
DestroyContext tid -1229329520 in critical region, js_ContextNum 1
Tid -1229329520 sets -1229329520 to sem 1 tid2
Tid -1229329520 sets -1229329520 to sem 2 tid1
Tid -1229329520 wait on sem 1
Tid -1229329520 wakes up on sem 1
Tid -1229329520 js_WaitForGC in js_DestroyContext
enter js_GC tid -1229329520, rt state 3, gcLevel 0
Tid -1229329520 js_MarkScriptFilenames
Tid -1229329520 destroy js_FinishRuntimeScriptState
Tid -1229329520 post on sem 2
Tid -1220404336 wakes up on sem 2
Tid -1220404336 js_MarkScriptFilenames
Tid -1220404336 js_MarkScriptFilenames NUUUUUUUL, will CRASH without the
scriptFilenameTable check! 0
Tid -1220404336 js_SweepScriptFilenames NUUUUUUUL, will CRASH without the
scriptFilenameTable check!


A crash and its gdb backtrace if I remove the NULL check at
js_{Mark,Sweep}ScriptFilenames functions (we can see that ht=0x0, because
js_FinishRuntimeScriptState has already destroyed this table):

(gdb) bt
#0  JS_HashTableEnumerateEntries (ht=0x0, f=0x80ccb10
&lt;js_script_filename_sweeper&gt;, arg=0x8135818) at jshash.cpp:361
#1  0x080cd1e0 in js_SweepScriptFilenames (rt=0x8135818) at jsscript.cpp:1310
#2  0x08080a83 in js_GC (cx=0x813d310, gckind=GC_NORMAL) at jsgc.cpp:3744
#3  0x0805d8f5 in js_DestroyContext (cx=0x813d310, mode=JSDCM_FORCE_GC) at
jscntxt.cpp:768
#4  0x0804e759 in JS_DestroyContext (cx=0x813d310) at jsapi.cpp:1074
#5  0x0804a4d7 in RunJavascript ()</pre>
    </div>
  <div class="bz_comment">

      <div class="bz_comment_head">

          <span class="bz_comment_actions">
            <script type="text/javascript"><!--
              addReplyLink(1, 4290022);
              addCollapseLink(1); // -->
            </script>[<a href="#add_comment" onclick="replyToComment(1,4290022); return false;">reply</a>] <a href="#" class="bz_collapse_comment" id="comment_link_1" onclick="toggle_comment_display(this, 1); return false;" title="Collapse the comment.">[-]</a> 
          </span>


        <span class="bz_comment_number">
          <a name="c1" href="https://bugzilla.mozilla.org/show_bug.cgi?id=515403#c1">Comment 1</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><a class="email" href="mailto:hc2428@columbia.edu" title="Heming Cui &lt;hc2428@columbia.edu&gt;"> <span class="fn">Heming Cui</span></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2009-09-09 09:46:21 PDT
        </span>
      </div>



<pre class="bz_comment_text" id="comment_text_1">My patch for adding semaphores, my testcase, and the pseudo code for the
feasible schedule will come soon.</pre>
    </div>
  <div class="bz_comment">

      <div class="bz_comment_head">

          <span class="bz_comment_actions">
            <script type="text/javascript"><!--
              addReplyLink(2, 4290047);
              addCollapseLink(2); // -->
            </script>[<a href="#add_comment" onclick="replyToComment(2,4290047); return false;">reply</a>] <a href="#" class="bz_collapse_comment" id="comment_link_2" onclick="toggle_comment_display(this, 2); return false;" title="Collapse the comment.">[-]</a> 
          </span>


        <span class="bz_comment_number">
          <a name="c2" href="https://bugzilla.mozilla.org/show_bug.cgi?id=515403#c2">Comment 2</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><a class="email" href="mailto:hc2428@columbia.edu" title="Heming Cui &lt;hc2428@columbia.edu&gt;"> <span class="fn">Heming Cui</span></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2009-09-09 09:57:52 PDT
        </span>
      </div>



<pre class="bz_comment_text" id="comment_text_2">Created <span class=""><a href="https://bugzilla.mozilla.org/attachment.cgi?id=399496" name="attach_399496" title="patch for semphores. We just need two semaphores to expose this bug order.">attachment 399496</a> <a href="https://bugzilla.mozilla.org/attachment.cgi?id=399496&amp;action=edit" title="patch for semphores. We just need two semaphores to expose this bug order.">[details]</a></span>
patch for semphores. We just need two semaphores to expose this bug order.

For the old code in js-1.5, I need 3 threads and 4 semphores to expose this bug
order (please refer to the <span class="bz_closed"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=133773" title="VERIFIED FIXED - malign race to use and destroy runtime state in js_DestroyContext">bug 133773</a></span> page for more details). However, in
latest source code in hg, I just need 2 threads and 2 semaphores. It seems to
me that the latest code are more vulnerable to this bug.</pre>
    </div>
  <div class="bz_comment">

      <div class="bz_comment_head">

          <span class="bz_comment_actions">
            <script type="text/javascript"><!--
              addReplyLink(3, 4290052);
              addCollapseLink(3); // -->
            </script>[<a href="#add_comment" onclick="replyToComment(3,4290052); return false;">reply</a>] <a href="#" class="bz_collapse_comment" id="comment_link_3" onclick="toggle_comment_display(this, 3); return false;" title="Collapse the comment.">[-]</a> 
          </span>


        <span class="bz_comment_number">
          <a name="c3" href="https://bugzilla.mozilla.org/show_bug.cgi?id=515403#c3">Comment 3</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><a class="email" href="mailto:hc2428@columbia.edu" title="Heming Cui &lt;hc2428@columbia.edu&gt;"> <span class="fn">Heming Cui</span></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2009-09-09 10:00:09 PDT
        </span>
      </div>



<pre class="bz_comment_text" id="comment_text_3">Created <span class=""><a href="https://bugzilla.mozilla.org/attachment.cgi?id=399499" name="attach_399499" title="my testcase, just two threads.">attachment 399499</a> <a href="https://bugzilla.mozilla.org/attachment.cgi?id=399499&amp;action=edit" title="my testcase, just two threads.">[details]</a></span>
my testcase, just two threads.</pre>
    </div>
  <div class="bz_comment">

      <div class="bz_comment_head">

          <span class="bz_comment_actions">
            <script type="text/javascript"><!--
              addReplyLink(4, 4290088);
              addCollapseLink(4); // -->
            </script>[<a href="#add_comment" onclick="replyToComment(4,4290088); return false;">reply</a>] <a href="#" class="bz_collapse_comment" id="comment_link_4" onclick="toggle_comment_display(this, 4); return false;" title="Collapse the comment.">[-]</a> 
          </span>


        <span class="bz_comment_number">
          <a name="c4" href="https://bugzilla.mozilla.org/show_bug.cgi?id=515403#c4">Comment 4</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><a class="email" href="mailto:hc2428@columbia.edu" title="Heming Cui &lt;hc2428@columbia.edu&gt;"> <span class="fn">Heming Cui</span></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2009-09-09 10:14:06 PDT
        </span>
      </div>



<pre class="bz_comment_text" id="comment_text_4">Created <span class=""><a href="https://bugzilla.mozilla.org/attachment.cgi?id=399501" name="attach_399501" title="the pseudo shows how threads and semaphores work in my patch.">attachment 399501</a> <a href="https://bugzilla.mozilla.org/attachment.cgi?id=399501&amp;action=edit" title="the pseudo shows how threads and semaphores work in my patch.">[details]</a></span>
the pseudo shows how threads and semaphores work in my patch.

Assume only two threads are setup, so after thread T2 remove its context from
list, the list becomes empty, so T2 will try to destroy the hash table.
However, while T2 is destroying the hash table, the garbage collection of T1
has not finished yet.</pre>
    </div>
  <div class="bz_comment">

      <div class="bz_comment_head">

          <span class="bz_comment_actions">
            <script type="text/javascript"><!--
              addReplyLink(5, 4290106);
              addCollapseLink(5); // -->
            </script>[<a href="#add_comment" onclick="replyToComment(5,4290106); return false;">reply</a>] <a href="#" class="bz_collapse_comment" id="comment_link_5" onclick="toggle_comment_display(this, 5); return false;" title="Collapse the comment.">[-]</a> 
          </span>


        <span class="bz_comment_number">
          <a name="c5" href="https://bugzilla.mozilla.org/show_bug.cgi?id=515403#c5">Comment 5</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><a class="email" href="mailto:hc2428@columbia.edu" title="Heming Cui &lt;hc2428@columbia.edu&gt;"> <span class="fn">Heming Cui</span></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2009-09-09 10:22:11 PDT
        </span>
      </div>



<pre class="bz_comment_text" id="comment_text_5">The source code version in hg repository is up to 2009-9-8. Especially,
jscntxt.cpp is Aug 20, and jsgc.cpp is Aug 24.



hg log jscntxt.cpp 
changeset:   31911:371c845dfd5d
user:        Jason Orendorff &lt;jorendorff@mozilla.com&gt;
date:        Thu Aug 20 14:13:21 2009 -0500
summary:     <span class="bz_closed"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=511418" title="RESOLVED FIXED - static-analysis error in jsobj.cpp:4257: cannot access JS_REQUIRES_STACK variable JSContext::fp">Bug 511418</a></span> - static-analysis error in jsobj.cpp:4257: cannot
access JS_REQUIRES_STACK variable JSContext::fp and another trivial error in
jstracer.cpp. r=gal.



hg log jsgc.cpp
changeset:   31939:7b7f9ae673cf
user:        David Anderson &lt;danderson@mozilla.com&gt;
date:        Mon Aug 24 17:09:44 2009 -0700
summary:     Removed JSStackFrame::callee (<span class="bz_closed"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=512029" title="RESOLVED FIXED - Remove JSStackFrame::callee">bug 512029</a></span>, r=brendan).</pre>
    </div>
  <div class="bz_comment">

      <div class="bz_comment_head">

          <span class="bz_comment_actions">
            <script type="text/javascript"><!--
              addReplyLink(6, 4294782);
              addCollapseLink(6); // -->
            </script>[<a href="#add_comment" onclick="replyToComment(6,4294782); return false;">reply</a>] <a href="#" class="bz_collapse_comment" id="comment_link_6" onclick="toggle_comment_display(this, 6); return false;" title="Collapse the comment.">[-]</a> 
          </span>


        <span class="bz_comment_number">
          <a name="c6" href="https://bugzilla.mozilla.org/show_bug.cgi?id=515403#c6">Comment 6</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><a class="email" href="mailto:hc2428@columbia.edu" title="Heming Cui &lt;hc2428@columbia.edu&gt;"> <span class="fn">Heming Cui</span></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2009-09-11 11:27:59 PDT
        </span>
      </div>



<pre class="bz_comment_text" id="comment_text_6">Dear Developers,
    Is my description clear? If there is any another information I need to
provide, please tell me.

Thanks,
Heming</pre>
    </div>
  <div class="bz_comment">

      <div class="bz_comment_head">

          <span class="bz_comment_actions">
            <script type="text/javascript"><!--
              addReplyLink(7, 4294812);
              addCollapseLink(7); // -->
            </script>[<a href="#add_comment" onclick="replyToComment(7,4294812); return false;">reply</a>] <a href="#" class="bz_collapse_comment" id="comment_link_7" onclick="toggle_comment_display(this, 7); return false;" title="Collapse the comment.">[-]</a> 
          </span>


        <span class="bz_comment_number">
          <a name="c7" href="https://bugzilla.mozilla.org/show_bug.cgi?id=515403#c7">Comment 7</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><a class="email" href="mailto:brendan@mozilla.org" title="Brendan Eich &lt;brendan@mozilla.org&gt;"> <span class="fn">Brendan Eich</span></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2009-09-11 11:38:43 PDT
        </span>
      </div>



<pre class="bz_comment_text" id="comment_text_7">Heming, thanks for all the work -- I have not had time to look yet, way too
busy with other commitments. I'm hoping Igor has time.

/be</pre>
    </div>
  <div class="bz_comment">

      <div class="bz_comment_head">

          <span class="bz_comment_actions">
            <script type="text/javascript"><!--
              addReplyLink(8, 4315495);
              addCollapseLink(8); // -->
            </script>[<a href="#add_comment" onclick="replyToComment(8,4315495); return false;">reply</a>] <a href="#" class="bz_collapse_comment" id="comment_link_8" onclick="toggle_comment_display(this, 8); return false;" title="Collapse the comment.">[-]</a> 
          </span>


        <span class="bz_comment_number">
          <a name="c8" href="https://bugzilla.mozilla.org/show_bug.cgi?id=515403#c8">Comment 8</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><a class="email" href="mailto:igor@mir2.org" title="Igor Bukanov &lt;igor@mir2.org&gt;"> <span class="fn">Igor Bukanov</span></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2009-09-24 03:01:55 PDT
        </span>
      </div>



<pre class="bz_comment_text" id="comment_text_8">Created <span class="bz_obsolete"><a href="https://bugzilla.mozilla.org/attachment.cgi?id=402557&amp;action=diff" name="attach_402557" title="fix v1">attachment 402557</a> <a href="https://bugzilla.mozilla.org/attachment.cgi?id=402557&amp;action=edit" title="fix v1">[details]</a></span>
fix v1

The fix just removes the call to FinishRuntimeScriptState and this bug race
from js_DestroyContext. The same job is done when JS_DestroyContext calls
js_FreeRuntimeScriptState.</pre>
    </div>
  <div class="bz_comment">

      <div class="bz_comment_head">

          <span class="bz_comment_actions">
            <script type="text/javascript"><!--
              addReplyLink(9, 4315554);
              addCollapseLink(9); // -->
            </script>[<a href="#add_comment" onclick="replyToComment(9,4315554); return false;">reply</a>] <a href="#" class="bz_collapse_comment" id="comment_link_9" onclick="toggle_comment_display(this, 9); return false;" title="Collapse the comment.">[-]</a> 
          </span>


        <span class="bz_comment_number">
          <a name="c9" href="https://bugzilla.mozilla.org/show_bug.cgi?id=515403#c9">Comment 9</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><a class="email" href="mailto:igor@mir2.org" title="Igor Bukanov &lt;igor@mir2.org&gt;"> <span class="fn">Igor Bukanov</span></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2009-09-24 04:52:04 PDT
        </span>
      </div>



<pre class="bz_comment_text" id="comment_text_9">Created <span class=""><a href="https://bugzilla.mozilla.org/attachment.cgi?id=402564&amp;action=diff" name="attach_402564" title="fix v2">attachment 402564</a> <a href="https://bugzilla.mozilla.org/attachment.cgi?id=402564&amp;action=edit" title="fix v2">[details]</a></span>
fix v2

The new version moves clearance of rt-&gt;builfinFunctions into js_GC as doing
that in js_DestroyContext has the same race as this bug and theoretically could
lead to a shutdown leak. The patch also removes useless js_UnlockGCThing from
js_FinishNumberState as NaN and +-oo are long explicitly marked.</pre>
    </div>
  <div class="bz_comment">

      <div class="bz_comment_head">

          <span class="bz_comment_actions">
            <script type="text/javascript"><!--
              addReplyLink(10, 4315781);
              addCollapseLink(10); // -->
            </script>[<a href="#add_comment" onclick="replyToComment(10,4315781); return false;">reply</a>] <a href="#" class="bz_collapse_comment" id="comment_link_10" onclick="toggle_comment_display(this, 10); return false;" title="Collapse the comment.">[-]</a> 
          </span>


        <span class="bz_comment_number">
          <a name="c10" href="https://bugzilla.mozilla.org/show_bug.cgi?id=515403#c10">Comment 10</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><a class="email" href="mailto:brendan@mozilla.org" title="Brendan Eich &lt;brendan@mozilla.org&gt;"> <span class="fn">Brendan Eich</span></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2009-09-24 07:34:55 PDT
        </span>
      </div>



<pre class="bz_comment_text" id="comment_text_10">(In reply to <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=515403#c8">comment #8</a>)
<span class="quote">&gt; Created an attachment (id=402557) [details]
&gt; fix v1
&gt; 
&gt; The fix just removes the call to FinishRuntimeScriptState and this bug race
&gt; from js_DestroyContext. The same job is done when JS_DestroyContext calls
&gt; js_FreeRuntimeScriptState.</span>

JS_DestroyRuntime calls js_FreeRuntimeScriptState, rather -- which leaves the
space tied up during zero-contexts-active-on-runtime intervals, which was what
the over-complicated code patched by this bug's patch was trying to avoid.

Isn't there a race-free way to save that space, by analogy to the clearing of
rt-&gt;builtinFunctions in the patch, by calling js_FreeRuntimeScriptState from
js_GC?

/be</pre>
    </div>
  <div class="bz_comment">

      <div class="bz_comment_head">

          <span class="bz_comment_actions">
            <script type="text/javascript"><!--
              addReplyLink(11, 4317679);
              addCollapseLink(11); // -->
            </script>[<a href="#add_comment" onclick="replyToComment(11,4317679); return false;">reply</a>] <a href="#" class="bz_collapse_comment" id="comment_link_11" onclick="toggle_comment_display(this, 11); return false;" title="Collapse the comment.">[-]</a> 
          </span>


        <span class="bz_comment_number">
          <a name="c11" href="https://bugzilla.mozilla.org/show_bug.cgi?id=515403#c11">Comment 11</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><a class="email" href="mailto:igor@mir2.org" title="Igor Bukanov &lt;igor@mir2.org&gt;"> <span class="fn">Igor Bukanov</span></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2009-09-25 07:19:45 PDT
        </span>
      </div>



<pre class="bz_comment_text" id="comment_text_11">(In reply to <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=515403#c10">comment #10</a>)
<span class="quote">&gt; JS_DestroyRuntime calls js_FreeRuntimeScriptState, rather -- which leaves the
&gt; space tied up during zero-contexts-active-on-runtime intervals, which was what
&gt; the over-complicated code patched by this bug's patch was trying to avoid.</span>

The entries from rt-&gt;scriptFilenameTable are removed when they are swept using 
JS_HashTableEnumerateEntries. That function shrinks the hashtable when
necessary leaving just MINBUCKETS or 16 entries in the hasharray when all
entries are removed. Thus for an embedding that is frequently in the zero
context state, the space that the patch waste is minuscule. Moreover, for such
embedding the patch would avoid recreation of the table after compiling a new
script.

<span class="quote">&gt; 
&gt; Isn't there a race-free way to save that space, by analogy to the clearing of
&gt; rt-&gt;builtinFunctions in the patch, by calling js_FreeRuntimeScriptState from
&gt; js_GC?</span>

This is what I did in the initial version of the patch until I realized that
that code is not necessary due to the above reasoning.</pre>
    </div>
  <div class="bz_comment">

      <div class="bz_comment_head">

          <span class="bz_comment_actions">
            <script type="text/javascript"><!--
              addReplyLink(12, 4318007);
              addCollapseLink(12); // -->
            </script>[<a href="#add_comment" onclick="replyToComment(12,4318007); return false;">reply</a>] <a href="#" class="bz_collapse_comment" id="comment_link_12" onclick="toggle_comment_display(this, 12); return false;" title="Collapse the comment.">[-]</a> 
          </span>


        <span class="bz_comment_number">
          <a name="c12" href="https://bugzilla.mozilla.org/show_bug.cgi?id=515403#c12">Comment 12</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><a class="email" href="mailto:brendan@mozilla.org" title="Brendan Eich &lt;brendan@mozilla.org&gt;"> <span class="fn">Brendan Eich</span></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2009-09-25 10:38:43 PDT
        </span>
      </div>



<pre class="bz_comment_text" id="comment_text_12">Comment on <span class=""><a href="https://bugzilla.mozilla.org/attachment.cgi?id=402564&amp;action=diff" name="attach_402564" title="fix v2">attachment 402564</a> <a href="https://bugzilla.mozilla.org/attachment.cgi?id=402564&amp;action=edit" title="fix v2">[details]</a></span>
fix v2

Ok, maybe a comment about the space held being tiny is appropriate. r=me,
thanks.

/be</pre>
    </div>
  <div class="bz_comment">

      <div class="bz_comment_head">

          <span class="bz_comment_actions">
            <script type="text/javascript"><!--
              addReplyLink(13, 4319287);
              addCollapseLink(13); // -->
            </script>[<a href="#add_comment" onclick="replyToComment(13,4319287); return false;">reply</a>] <a href="#" class="bz_collapse_comment" id="comment_link_13" onclick="toggle_comment_display(this, 13); return false;" title="Collapse the comment.">[-]</a> 
          </span>


        <span class="bz_comment_number">
          <a name="c13" href="https://bugzilla.mozilla.org/show_bug.cgi?id=515403#c13">Comment 13</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><a class="email" href="mailto:igor@mir2.org" title="Igor Bukanov &lt;igor@mir2.org&gt;"> <span class="fn">Igor Bukanov</span></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2009-09-26 09:59:53 PDT
        </span>
      </div>



<pre class="bz_comment_text" id="comment_text_13"><a href="http://hg.mozilla.org/tracemonkey/rev/3fc33a44b5ef">http://hg.mozilla.org/tracemonkey/rev/3fc33a44b5ef</a>

I nominate this for branches as this bug race could lead to accessing freed
memory in some embedding or with Firefox addons. Note that in the browser
itself the race cannot happen as thread workers are shutdown strictly before
the last context is destroyed.</pre>
    </div>
  <div class="bz_comment">

      <div class="bz_comment_head">

          <span class="bz_comment_actions">
            <script type="text/javascript"><!--
              addReplyLink(14, 4335872);
              addCollapseLink(14); // -->
            </script>[<a href="#add_comment" onclick="replyToComment(14,4335872); return false;">reply</a>] <a href="#" class="bz_collapse_comment" id="comment_link_14" onclick="toggle_comment_display(this, 14); return false;" title="Collapse the comment.">[-]</a> 
          </span>


        <span class="bz_comment_number">
          <a name="c14" href="https://bugzilla.mozilla.org/show_bug.cgi?id=515403#c14">Comment 14</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><a class="email" href="mailto:sayrer@gmail.com" title="Robert Sayre &lt;sayrer@gmail.com&gt;"> <span class="fn">Robert Sayre</span></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2009-10-07 09:24:39 PDT
        </span>
      </div>



<pre class="bz_comment_text" id="comment_text_14"><a href="http://hg.mozilla.org/mozilla-central/rev/3fc33a44b5ef">http://hg.mozilla.org/mozilla-central/rev/3fc33a44b5ef</a></pre>
    </div>
  <div class="bz_comment">

      <div class="bz_comment_head">

          <span class="bz_comment_actions">
            <script type="text/javascript"><!--
              addReplyLink(15, 4396162);
              addCollapseLink(15); // -->
            </script>[<a href="#add_comment" onclick="replyToComment(15,4396162); return false;">reply</a>] <a href="#" class="bz_collapse_comment" id="comment_link_15" onclick="toggle_comment_display(this, 15); return false;" title="Collapse the comment.">[-]</a> 
          </span>


        <span class="bz_comment_number">
          <a name="c15" href="https://bugzilla.mozilla.org/show_bug.cgi?id=515403#c15">Comment 15</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><a class="email" href="mailto:sayrer@gmail.com" title="Robert Sayre &lt;sayrer@gmail.com&gt;"> <span class="fn">Robert Sayre</span></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2009-11-12 17:57:15 PST
        </span>
      </div>



<pre class="bz_comment_text" id="comment_text_15"><a href="http://hg.mozilla.org/releases/mozilla-1.9.2/rev/57dd0e5cd293">http://hg.mozilla.org/releases/mozilla-1.9.2/rev/57dd0e5cd293</a></pre>
    </div>
  <div class="bz_comment">

      <div class="bz_comment_head">

          <span class="bz_comment_actions">
            <script type="text/javascript"><!--
              addReplyLink(16, 4418473);
              addCollapseLink(16); // -->
            </script>[<a href="#add_comment" onclick="replyToComment(16,4418473); return false;">reply</a>] <a href="#" class="bz_collapse_comment" id="comment_link_16" onclick="toggle_comment_display(this, 16); return false;" title="Collapse the comment.">[-]</a> 
          </span>


        <span class="bz_comment_number">
          <a name="c16" href="https://bugzilla.mozilla.org/show_bug.cgi?id=515403#c16">Comment 16</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><a class="email" href="mailto:slice4e@gmail.com" title="Martin &lt;slice4e@gmail.com&gt;"> <span class="fn">Martin</span></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2009-11-25 12:24:49 PST
        </span>
      </div>



<pre class="bz_comment_text" id="comment_text_16">(In reply to <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=515403#c6">comment #6</a>)
<span class="quote">&gt; Dear Developers,
&gt;     Is my description clear? If there is any another information I need to
&gt; provide, please tell me.
&gt; 
&gt; Thanks,
&gt; Heming</span>

Heming, 

I am a PhD student from UCF and my research involves techniques for debugging. 
I would like to study this bug, but I am new to Mozilla. Can you please help me
reproduce the bug. 

Here is what I have so far: 

- I checked out an old version of the code from 9-8-2009.

$ hg clone <a href="http://hg.mozilla.org/releases/comm-1.9.1/">http://hg.mozilla.org/releases/comm-1.9.1/</a>
$ python client.py --comm-rev=b7f6edb75fa --mozilla-rev=dd9b10ed7eeb checkout

- Then I applied your patch with the semaphores and finally, I compiled
mozilla. 

- However, I am not able to compile your test program: test-js.cpp
Can u please tell me how to compile and run that, in order to trigger the bug. 

Thank you very much, 

Martin</pre>
    </div>
  <div class="bz_comment">

      <div class="bz_comment_head">

          <span class="bz_comment_actions">
            <script type="text/javascript"><!--
              addReplyLink(17, 4430208);
              addCollapseLink(17); // -->
            </script>[<a href="#add_comment" onclick="replyToComment(17,4430208); return false;">reply</a>] <a href="#" class="bz_collapse_comment" id="comment_link_17" onclick="toggle_comment_display(this, 17); return false;" title="Collapse the comment.">[-]</a> 
          </span>


        <span class="bz_comment_number">
          <a name="c17" href="https://bugzilla.mozilla.org/show_bug.cgi?id=515403#c17">Comment 17</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><a class="email" href="mailto:slice4e@gmail.com" title="Martin &lt;slice4e@gmail.com&gt;"> <span class="fn">Martin</span></a>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2009-12-01 10:36:57 PST
        </span>
      </div>



<pre class="bz_comment_text" id="comment_text_17">Hi, 

I figured out how to reproduce the bug. 

Thanks, 
Martin</pre>
    </div>
  

  

</td>
<td>
    <ul class="bz_collapse_expand_comments">
      <li><a href="#" onclick="toggle_all_comments('collapse'); 
                               return false;">Collapse All Comments</a></li>
      <li><a href="#" onclick="toggle_all_comments('expand');
                               return false;">Expand All Comments</a></li>
    </ul>
</td>
</tr></tbody></table>
  </div>

    <hr><div class="bz_section_additional_comments">
    <a name="add_comment"></a>
      <label for="comment" accesskey="c"><b>Additional 
        <u>C</u>omments</b></label>:


      <!-- This table keeps the submit button aligned with the box. -->
      <table><tbody><tr><td><textarea name="comment" id="comment" rows="10" cols="80"></textarea>
        <br><div class="knob-buttons">
      <input value="Save Changes" id="commit" type="submit">
    </div>

        <table class="status" cellpadding="0" cellspacing="0">
          <tbody><tr>
            <td class="field_label">
              <b><a href="https://bugzilla.mozilla.org/page.cgi?id=fields.html#status">Status</a></b>:
            </td>
            <td>
              <a name="bug_status_bottom"></a><div id="status">RESOLVED

    <noscript><br>resolved&nbsp;as&nbsp;</noscript>

  <span id="resolution_settings">FIXED
  </span>

</div>

<script type="text/javascript">
  var close_status_array = [
      'RESOLVED'
  ];
  YAHOO.util.Dom.removeClass('dup_id_discoverable', 'bz_default_hidden');
  hideEditableField( "dup_id_container", "dup_id", 'dup_id_edit_action',
                     'dup_id', '' )
  showHideStatusItems( "",  ['',
                             'RESOLVED']);
  YAHOO.util.Event.addListener( 'bug_status', "change", showHideStatusItems,
                                ['',
                                 'RESOLVED']);
  YAHOO.util.Event.addListener( 'resolution', "change", showDuplicateItem);
  YAHOO.util.Event.addListener( 'dup_id_discoverable_action',
                                'click',
                                setResolutionToDuplicate,
                                'RESOLVED');
  YAHOO.util.Event.addListener( window, 'load',  showHideStatusItems,
                              ['',
                               'RESOLVED'] );

</script>
            </td>
          </tr>
        </tbody></table>
      </td></tr></tbody></table>

    
  </div>

</form>

<hr>
<ul class="related_actions">
    <li><a href="https://bugzilla.mozilla.org/show_bug.cgi?format=multiple&amp;id=515403">Format For Printing</a></li>
    <li>&nbsp;-&nbsp;<a href="https://bugzilla.mozilla.org/show_bug.cgi?ctype=xml&amp;id=515403">XML</a></li>
    <li>&nbsp;-&nbsp;<a href="https://bugzilla.mozilla.org/enter_bug.cgi?cloned_bug_id=515403">Clone This Bug</a></li>
    
    <li>&nbsp;-&nbsp;<a href="#">Top of page </a></li>
    </ul>        


<div class="navigation">
  
  <i><font color="#777777">First</font></i>
  <i><font color="#777777">Last</font></i>
  <i><font color="#777777">Prev</font></i>
  <i><font color="#777777">Next</font></i>
  &nbsp;&nbsp;
  <i><font color="#777777">No search results available</font></i>
</div>

<br>
</div>



<div id="footer">
  <div class="intro"></div>




<ul id="useful-links">
  <li id="links-actions"><ul class="links">
  <li><a href="https://bugzilla.mozilla.org/">Home</a></li>
  <li><span class="separator">| </span><a href="https://bugzilla.mozilla.org/enter_bug.cgi">New</a></li>
  <li><span class="separator">| </span><a href="https://bugzilla.mozilla.org/describecomponents.cgi">Browse</a></li>
  <li><span class="separator">| </span><a href="https://bugzilla.mozilla.org/query.cgi">Search</a></li>

  <li class="form">
    <span class="separator">| </span>
    <form action="buglist.cgi" method="get" onsubmit="if (this.quicksearch.value == '')
                  { alert('Please enter one or more search terms first.');
                    return false; } return true;">
    <input class="txt" id="quicksearch_bottom" name="quicksearch" type="text">
    <input class="btn" value="Search" id="find_bottom" type="submit"></form>
  <a href="https://bugzilla.mozilla.org/page.cgi?id=quicksearch.html" title="Quicksearch Help">[?]</a></li>

  <li><span class="separator">| </span><a href="https://bugzilla.mozilla.org/report.cgi">Reports</a></li>

  <li>
      <span class="separator">| </span>
        <a href="https://bugzilla.mozilla.org/request.cgi?requester=naj5c%40virginia.edu&amp;requestee=naj5c%40virginia.edu&amp;do_union=1&amp;group=type&amp;action=queue">My Requests</a></li>

    <li><span class="separator">| </span><a href="https://bugzilla.mozilla.org/userprefs.cgi">Preferences</a></li>
<li>
        <span class="separator">| </span>
        <a href="http://www.bugzilla.org/docs/3.6/en/html/bug_page.html" target="_blank">Help</a>
      </li>

    <li>
      <span class="separator">| </span>
        <a href="https://bugzilla.mozilla.org/index.cgi?logout=1">Log&nbsp;out</a>
        naj5c@virginia.edu</li>
</ul>
  </li>

  
    
    <li id="links-saved">
      <ul class="links">
          <li><a href="https://bugzilla.mozilla.org/buglist.cgi?bug_status=UNCONFIRMED&amp;bug_status=NEW&amp;bug_status=ASSIGNED&amp;bug_status=REOPENED&amp;emailassigned_to1=1&amp;emailreporter1=1&amp;emailtype1=exact&amp;email1=naj5c%40virginia.edu&amp;field0-0-0=bug_status&amp;type0-0-0=notequals&amp;value0-0-0=UNCONFIRMED&amp;field0-0-1=reporter&amp;type0-0-1=equals&amp;value0-0-1=naj5c%40virginia.edu">My Bugs</a></li>

      </ul>
    </li>

  


  
</ul>

  <div class="outro"></div>
</div>

</body></html>
